# Агент анализа финансовой устойчивости

Инструмент для анализа российской бухгалтерской отчётности (баланс, ОФР, ОДДС) в формате PDF:

- извлекает таблицы с помощью MinerU;
- считает ключевые коэффициенты финансовой устойчивости;
- оценивает динамику (темпы прироста по строкам отчётности);
- рассчитывает интегральный индекс финансовой устойчивости (0..1);
- предоставляет веб-интерфейс на Streamlit;
- опционально даёт текстовый вывод ИИ через Ollama (модель qwen2.5:32b).

## Структура проекта

- `agent.py` — единый файл: backend (MinerU, расчёт коэффициентов) + веб-интерфейс (Streamlit).
- `install_env.bat` — установка виртуального окружения и зависимостей.
- `source/` — сюда складываются исходные PDF.
- `new_out/` — рабочая папка MinerU (создаётся автоматически).
- `results/` — готовые `.txt`-отчёты (создаётся автоматически).

## Требования

- Windows 10/11.
- Python **3.10 или 3.11** (не выше — MinerU несовместим с 3.12+).
- Интернет при первом запуске (установка зависимостей и загрузка моделей MinerU ~5 ГБ).
- MinerU устанавливается через pip (входит в `requirements.txt`).
- *По желанию*: Ollama + модель `qwen2.5:32b` для ИИ-комментариев.

> **Важно**: при первом анализе PDF MinerU автоматически скачивает модели (~5 ГБ).
> Убедитесь, что есть стабильное интернет-соединение и достаточно места на диске.

## Установка

1. Скачайте проект (zip или `git clone`).
2. Убедитесь, что Python 3.10 или 3.11 добавлен в `PATH`.
3. Запустите `install_env.bat` **двойным кликом**.
   - Скрипт создаст виртуальное окружение `.venv` и установит все зависимости.
   - Установка может занять несколько минут.

## Запуск

```bat
.venv\Scripts\python.exe agent.py
```

Браузер откроется автоматически по адресу `http://localhost:8501`.

## Настройка Ollama (опционально)

Чтобы работали блоки с ИИ-выводом:

1. Установите Ollama: https://ollama.com/download
2. Запустите в отдельном окне:

   ```bash
   ollama serve
   ollama pull qwen2.5:32b
   ```

3. Перезапустите веб-интерфейс.

> Модель `qwen2.5:32b` весит ~20 ГБ. Для работы нужно минимум 32 ГБ ОЗУ или GPU с 24+ ГБ VRAM.
> Если ресурсов не хватает, можно заменить на `qwen2.5:7b` (в `app.py` строки с `model="qwen2.5:32b"`).

## Частые проблемы

| Проблема | Решение |
|---|---|
| `pip install` не находит пакеты или падает с ошибкой кодировки | Пересоздайте `requirements.txt` или убедитесь, что файл сохранён в UTF-8 |
| MinerU скачивает модели очень долго | Это нормально при первом запуске (~5 ГБ), дождитесь завершения |
| Ошибка `ModuleNotFoundError` | Запускайте команду из папки проекта, а не из другого места |
| Ollama не отвечает | Убедитесь, что `ollama serve` запущен в отдельном окне терминала |
| Python 3.12 / 3.13 — ошибки при установке MinerU | Используйте строго Python 3.10 или 3.11 |
